#status: done
id: "0x000B"
name: Location
description: Measure distance between devices.
server:
    attr:
    - id: "0x0000"
      name: Location Type
      type: enum8
      access: rw
      required: true
      bits:
        "0": Absolute location
        "1": Two dimensional
    - id: "0x0001"
      name: Location Method
      type: enum8
      access: rw
      required: true
      values:
        "0x00": Lateration
        "0x01": Signposting
        "0x02": RF fingerprinting
        "0x03": Out of band
        "0x04": Centralized
    - id: "0x0002"
      name: Location Age
      type: u16
      unit: s
      access: r
    - id: "0x0003"
      name: Quality Measure
      type: u8
      range: 0x00,0x64
      access: r
      unit: "%"
    - id: "0x0004"
      name: Number of Devices
      type: u8
      access: r
    - id: "0x0010"
      name: X Coordinate
      type: s16
      range: -32768,32767
      access: rw
      unit: m
      multiplier: 10
      required: true
    - id: "0x0011"
      name: Y Coordinate
      type: s16
      range: -32768,32767
      access: rw
      unit: m
      multiplier: 10
      required: true
    - id: "0x0012"
      name: Z Coordinate
      type: s16
      range: -32768,32767
      access: rw
      unit: m
      multiplier: 10
      required: false
    - id: "0x0013"
      name: Power
      type: s16
      range: -32768,32767
      access: rw
      unit: dBm
      multiplier: 100
      invalid: 0x8000
      required: true
    - id: "0x0014"
      name: Path loss Exponent
      description: Rate at which the signal power decays with increasing distance
      type: u16
      access: rw
      required: true
      multiplier: 0.01
      invalid: 0xffff
    - id: "0x0015"
      name: Reporting Period
      type: u16
      access: rw
      unit: s
    - id: "0x0016"
      name: Calculation Period
      type: u16
      access: rw
      unit: s
    - id: "0x0017"
      name: Number RSSI Measurements
      description: Number of measurements to use to generate one location estimate
      type: u8
      range: 0x01,0xff
      access: rw
    cmd:
      - id: "0x00"
        name: Set Absolute Location
        required: m
        dir: recv
        payloadattr:
          - id: "0x0000"
            name: X Coordinate
            type: s16
            range: -32768,32767
            access: rw
            unit: m
            multiplier: 10
            required: true
          - id: "0x0001"
            name: Y Coordinate
            type: s16
            range: -32768,32767
            access: rw
            unit: m
            multiplier: 10
            required: true
          - id: "0x0002"
            name: Z Coordinate
            type: s16
            range: -32768,32767
            access: rw
            unit: m
            multiplier: 10
            required: false
          - id: "0x0003"
            name: Power
            type: s16
            range: -32768,32767
            access: rw
            unit: dBm
            multiplier: 100
            invalid: 0x8000
            required: true
          - id: "0x0004"
            name: Path loss Exponent
            description: Rate at which the signal power decays with increasing distance
            type: u16
            access: rw
            required: true
            multiplier: 0.01
            invalid: 0xffff
      - id: "0x01"
        name: Set Device Configuration
        required: m
        dir: recv
        payloadattr:
          - id: "0x0000"
            name: Power
            type: s16
            range: -32768,32767
            unit: dBm
            multiplier: 100
            invalid: 0x8000
            required: true
          - id: "0x0001"
            name: Path loss Exponent
            description: Rate at which the signal power decays with increasing distance
            type: u16
            required: true
            multiplier: 0.01
            invalid: 0xffff
          - id: "0x0002"
            name: Calculation Period
            type: u16
            unit: s
          - id: "0x0003"
            name: Number RSSI Measurements
            description: Number of measurements to use to generate one location estimate
            type: u8
            range: 0x01,0xff
          - id: "0x0004"
            name: Reporting Period
            type: u16
            unit: s
      - id: "0x02"
        name: Get Device Configuration
        required: m
        dir: recv
        response: "0x00"
        payloadattr:
          - id: "0x0000"
            name: "Target Address"
            type: uid
      - id: "0x03"
        name: Get Location Data
        response: "0x01"
        required: m
        payloadattr:
          - id: "0x0000"
            type: bmp8
            name: Flags
            bits:
              "0": Absolute Only
              "1": Recalculate
              "2": Broadcast Indicator
              "3": Broadcast Response
              "4": Compact Response
          - id: "0x0001"
            name: Number Responses
            type: u8
          - id: "0x0002"
            name: Target Address
            type: uid
      - id: "0x04"
        name: RSSI Response
        required: m
        dir: recv
        payloadattr:
          - id: "0x0000"
            name: Replying device
            type: uid
          - id: "0x0001"
            name: X Coordinate
            type: s16
            range: -32768,32767
            unit: m
            multiplier: 10
          - id: "0x0002"
            name: Y Coordinate
            type: s16
            range: -32768,32767
            unit: m
            multiplier: 10
          - id: "0x0003"
            name: Z Coordinate
            type: s16
            range: -32768,32767
            unit: m
            multiplier: 10
          - id: "0x0004"
            name: RSSI
            type: s8
            unit: dBm
          - id: "0x0005"
            name: NumberRSSIMeasurements
            type: uint8
      - id: "0x05"
        name: Send Pings
        required: o
        response: "0x06"
        payloadattr:
          - id: "0x0000"
            name: Target Address
            type: uid
          - id: "0x0001"
            name: Number RSSI Measurements
            description: Number of measurements to use to generate one location estimate
            type: u8
            range: 0x01,0xff
          - id: "0x0002"
            name: Calculation Period
            type: u16
            unit: s
      - id: "0x06"
        name: Anchor Node Announce
        required: o
        payloadattr:
          - id: "0x0000"
            name: Anchor Node Address
            type: uid
          - id: "0x0001"
            name: X Coordinate
            type: s16
            range: -32768,32767
            unit: m
            multiplier: 10
          - id: "0x0002"
            name: Y Coordinate
            type: s16
            range: -32768,32767
            unit: m
            multiplier: 10
          - id: "0x0003"
            name: Z Coordinate
            type: s16
            range: -32768,32767
            unit: m
            multiplier: 10
      - id: "0x40"
        name: Distance measure
        dir: recv
        required: m
        response: "0x40"
        showas: hex
        payloadattr:
          - id: "0x0000"
            name: Target address
            type: u16
            default: "0x0000"
            required: true
          - id: "0x0001"
            name: Resolution
            type: enum8
            default: "0x00"
            required: true
            values:
                "0x00": High
                "0x01": Mid
                "0x02": Low
client:
    cmd:
      - id: "0x00"
        name: Device Configuration Response
        dir: recv
        required: m
        payloadattr:
          - id: "0x0000"
            name: Status
            type: enum8
            enumeration: ZCL_Status
          - id: "0x0001"
            name: Power
            type: s16
            range: -32768,32767
            unit: dBm
            multiplier: 100
            invalid: 0x8000
            cond:
              - attr: 0x0000
                value: 0x00
          - id: "0x0002"
            name: Path loss Exponent
            description: Rate at which the signal power decays with increasing distance
            type: u16
            multiplier: 0.01
            invalid: 0xffff
            cond:
              - attr: 0x0000
                value: 0x00
          - id: "0x0003"
            name: Calculation Period
            type: u16
            unit: s
            cond:
              - attr: 0x0000
                value: 0x00
          - id: "0x0004"
            name: Number RSSI Measurements
            description: Number of measurements to use to generate one location estimate
            type: u8
            range: 0x01,0xff
            cond:
              - attr: 0x0000
                value: 0x00
          - id: "0x0005"
            name: Reporting Period
            type: u16
            unit: s
            cond:
              - attr: 0x0000
                value: 0x00

      - id: "0x01"
        name: Location Data Response
        dir: recv
        required: m
        payloadattr:
          - id: "0x0000"
            name: Status
            type: enum8
            enumeration: ZCL_Status
          - id: "0x0001"
            name: Location Type
            type: enum8
            cond:
              - attr: 0x0000
                value: 0x00
            bits:
              "0": Absolute location
              "1": Two dimensional
          - id: "0x0002"
            name: X Coordinate
            type: s16
            range: -32768,32767
            unit: m
            multiplier: 10
            cond:
              - attr: 0x0000
                value: 0x00
          - id: "0x0003"
            name: Y Coordinate
            type: s16
            range: -32768,32767
            unit: m
            multiplier: 10
            cond:
              - attr: 0x0000
                value: 0x00
          - id: "0x0004"
            name: Z Coordinate
            type: s16
            range: -32768,32767
            unit: m
            multiplier: 10
            cond:
              - attr: 0x0000
                value: 0x00
              - attr: 0x0001
                mask: 0x02
                value: 0x00
          - id: "0x0005"
            name: Power
            type: s16
            range: -32768,32767
            access: rw
            unit: dBm
            multiplier: 100
            invalid: 0x8000
            cond:
              - attr: 0x0000
                value: 0x00
          - id: "0x0006"
            name: Path loss Exponent
            description: Rate at which the signal power decays with increasing distance
            type: u16
            access: rw
            cond:
              - attr: 0x0000
                value: 0x00
            multiplier: 0.01
            invalid: 0xffff
          - id: "0x0007"
            name: Location Method
            type: enum8
            cond:
              - attr: 0x0000
                value: 0x00
              - attr: 0x0001
                mask: 0x01
                value: 0x00
            values:
              "0x00": Lateration
              "0x01": Signposting
              "0x02": RF fingerprinting
              "0x03": Out of band
              "0x04": Centralized
          - id: "0x0008"
            name: Quality Measure
            type: u8
            range: 0x00,0x64
            unit: "%"
            cond:
              - attr: 0x0000
                value: 0x00
              - attr: 0x0001
                mask: 0x01
                value: 0x00
          - id: "0x0009"
            name: Location Age
            type: u16
            unit: s
            cond:
              - attr: 0x0000
                value: 0x00
              - attr: 0x0001
                mask: 0x01
                value: 0x00
      - id: "0x02"
        name: Location Data Notification
        dir: recv
        required: m
        payloadattr:
          - id: "0x0000"
            name: Location Type
            type: enum8
            bits:
              "0": Absolute location
              "1": Two dimensional
          - id: "0x0001"
            name: X Coordinate
            type: s16
            range: -32768,32767
            unit: m
            multiplier: 10
          - id: "0x0002"
            name: Y Coordinate
            type: s16
            range: -32768,32767
            unit: m
            multiplier: 10
          - id: "0x0003"
            name: Z Coordinate
            type: s16
            range: -32768,32767
            unit: m
            multiplier: 10
            cond:
              - attr: 0x0000
                mask: 0x02
                value: 0x00
          - id: "0x0004"
            name: Power
            type: s16
            range: -32768,32767
            access: rw
            unit: dBm
            multiplier: 100
            invalid: 0x8000
          - id: "0x0005"
            name: Path loss Exponent
            description: Rate at which the signal power decays with increasing distance
            type: u16
            access: rw
            multiplier: 0.01
            invalid: 0xffff
          - id: "0x0006"
            name: Location Method
            type: enum8
            cond:
              - attr: 0x0000
                mask: 0x01
                value: 0x00
            values:
              "0x00": Lateration
              "0x01": Signposting
              "0x02": RF fingerprinting
              "0x03": Out of band
              "0x04": Centralized
          - id: "0x0007"
            name: Quality Measure
            type: u8
            range: 0x00,0x64
            unit: "%"
            cond:
              - attr: 0x0000
                mask: 0x01
                value: 0x00
          - id: "0x0008"
            name: Location Age
            type: u16
            unit: s
            cond:
              - attr: 0x0000
                mask: 0x01
                value: 0x00
      - id: "0x03"
        name: Compact Location Data Notification
        dir: recv
        required: m
        payloadattr:
          - id: "0x0000"
            name: Location Type
            type: enum8
            bits:
              "0": Absolute location
              "1": Two dimensional
          - id: "0x0001"
            name: X Coordinate
            type: s16
            range: -32768,32767
            unit: m
            multiplier: 10
          - id: "0x0002"
            name: Y Coordinate
            type: s16
            range: -32768,32767
            unit: m
            multiplier: 10
          - id: "0x0003"
            name: Z Coordinate
            type: s16
            range: -32768,32767
            unit: m
            multiplier: 10
            cond:
              - attr: 0x0000
                mask: 0x02
                value: 0x00
          - id: "0x0004"
            name: Quality Measure
            type: u8
            range: 0x00,0x64
            unit: "%"
            cond:
              - attr: 0x0000
                mask: 0x01
                value: 0x00
          - id: "0x0005"
            name: Location Age
            type: u16
            unit: s
            cond:
              - attr: 0x0000
                mask: 0x01
                value: 0x00
      - id: "0x04"
        name: RSSI Ping
        dir: recv
        required: m
        payloadattr:
          - id: "0x0000"
            name: Location Type
            type: enum8
            bits:
              "0": Absolute location
              "1": Two dimensional
      - id: "0x05"
        response: "0x04"
        name: RSSI Request
        dir: recv
        required: o
      - id: "0x06"
        name: Report RSSI Measurements
        dir: recv
        required: o
        payloadattr:
          - id: "0x0000"
            name: Measuring Device
            type: uid
          - id: "0x0001"
            name: Neighbors Info
            type: set
            arraytype: struct
            structattr:
                - id: "0x0000"
                  name: Neighbor
                  type: uid
                - id: "0x0001"
                  name: X Coordinate
                  type: s16
                  range: -32768,32767
                  unit: m
                  multiplier: 10
                - id: "0x0002"
                  name: Y Coordinate
                  type: s16
                  range: -32768,32767
                  unit: m
                  multiplier: 10
                - id: "0x0003"
                  name: Z Coordinate
                  type: s16
                  range: -32768,32767
                  unit: m
                  multiplier: 10
                - id: "0x0004"
                  name: RSSI
                  type: s8
                  unit: dBm
                - id: "0x0005"
                  name: Number of RSSI Measurements
                  type: u8
      - id: "0x07"
        name: Request Own Location
        dir: recv
        required: o
        response: "0x00"
        payloadattr:
          - id: "0x0000"
            name: "Blind Node Address"
            type: uid
      - id: "0x40"
        name: Distance measure response
        description: Returns the result of a distance measure.
        dir: recv
        required: m
        payloadattr:
          - id: "0x0000"
            name: Target address
            type: u16
            default: "0x0000"
            required: true
            showas: hex
          - id: "0x0001"
            name: Distance (Meter)
            type: u16
            default: "0"
            required: true
          - id: "0x0002"
            name: Quality index
            type: u16
            default: "0"
            required: true
